<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Menu with Virtual Sommelier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #FDF8F0; /* Warm Parchment Background */
        }
        h1, h2, h3, .font-serif {
            font-family: 'Playfair Display', serif;
        }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .allergen-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: #e5e7eb;
            color: #374151;
            font-weight: 500;
            font-size: 11px;
            margin: 2px;
            cursor: pointer;
            position: relative;
        }
        .allergen-tooltip {
            visibility: hidden;
            width: 140px;
            background-color: #1f2937;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px 0;
            position: absolute;
            z-index: 1;
            bottom: 130%;
            left: 50%;
            margin-left: -70px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
        }
        .allergen-icon:hover .allergen-tooltip {
            visibility: visible;
            opacity: 1;
        }
        .dish-card {
            transition: all 0.3s ease-in-out;
            border-top: 4px solid transparent;
        }
        .dish-card:hover {
            transform: translateY(-5px) scale(1.01);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            border-top-color: #D97706; /* Amber-600 */
        }
    </style>
</head>
<body class="bg-[#FDF8F0] text-stone-800">

    <!-- Main Container -->
    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-16">
            <h1 class="text-5xl md:text-7xl font-bold text-stone-900 tracking-tight">IXCHEL</h1>
            <p class="text-lg text-amber-800 mt-2 font-serif">An unforgettable culinary experience</p>
        </header>

        <!-- Food Menu Section -->
        <main id="food-menu-container">
            <!-- Menu content will be generated here by JavaScript -->
        </main>
    </div>

    <!-- Modal for Pairing and Details -->
    <div id="pairing-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50 opacity-0 pointer-events-none">
        <div id="modal-content" class="modal-content bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto transform scale-95">
            <!-- Modal content will be generated here by JavaScript -->
        </div>
    </div>


    <script>
    // --- DATABASE ---

    // Standard UK Allergens (FSA)
    const ALLERGENS_UK = {
        gluten: { name: "Gluten", icon: "G" },
        crustaceans: { name: "Crustaceans", icon: "Cr" },
        eggs: { name: "Eggs", icon: "E" },
        fish: { name: "Fish", icon: "F" },
        peanuts: { name: "Peanuts", icon: "P" },
        soybeans: { name: "Soybeans", icon: "S" },
        milk: { name: "Dairy", icon: "M" },
        nuts: { name: "Nuts", icon: "N" },
        celery: { name: "Celery", icon: "Ce" },
        mustard: { name: "Mustard", icon: "Mu" },
        sesame: { name: "Sesame", icon: "Se" },
        sulphites: { name: "Sulphites", icon: "SO₂" },
        lupin: { name: "Lupin", icon: "L" },
        molluscs: { name: "Molluscs", icon: "Mo" },
    };

    // Food Menu from 'ixchel london dishes 2025.pdf' (Complete)
    const foodMenu = [
        // Small Plates
        {
            id: 1, name: "GUACAMOLE", category: "Small Plates",
            description: "A vibrant and fresh preparation of the iconic Mexican dip. Perfectly ripe avocados are mashed with jalapeño, red onion, cilantro, and lime to create a creamy and zesty classic.",
            ingredients: ["Avocado", "jalapeño chili", "red onion", "cilantro", "lime", "tortilla strips", "pico de gallo"],
            history: "Originating with the Aztecs, 'āhuacamōlli' (Nahuatl for 'avocado sauce') has been a staple for centuries, believed to provide strength and act as an aphrodisiac.",
            allergens: [], pairingTags: ['starter', 'fresh', 'citrus', 'vegetarian', 'avocado']
        },
        {
            id: 2, name: "HOMEMADE BREAD FOCACCIA", category: "Small Plates",
            description: "A unique take on Italian focaccia with Mexican influences. Soft, airy bread garnished with leek and coconut, served with a complex guajillo chili oil and seaweed-seasoned butter.",
            ingredients: ["Flour", "yeast", "leek", "coconut", "salsa macha", "guajillo chili oil", "kombu and nori butter"],
            history: "This dish represents a culinary dialogue between Mexico and the world, infusing a European classic with native Mexican chiles and salsas.",
            allergens: ["gluten", "milk", "nuts", "sesame"], pairingTags: ['starter', 'rich', 'fusion', 'savory']
        },
        {
            id: 3, name: "ROCK SHRIMP TEMPURA", category: "Small Plates",
            description: "Crispy, light tempura-battered rock shrimp tossed in an 'adobo enchilado'. Served with a smoky charred eggplant purée and creamy avocado dressing.",
            ingredients: ["Shrimp", "adobo enchilado", "tempura flour", "charred eggplant purée", "avocado dressing"],
            history: "A nod to the Japanese culinary influence in Mexico, particularly in coastal regions. Tempura techniques are paired with a classic Mexican adobo for a spicy kick.",
            allergens: ["crustaceans", "gluten", "eggs"], pairingTags: ['seafood', 'fried', 'spicy', 'rich']
        },
        {
            id: 4, name: "TUNA TOSTADA", category: "Small Plates",
            description: "Delicate sashimi-grade tuna on a crisp tostada, complemented by a complex green pipián sauce, pico de gallo, and a hint of red jalapeño chili oil.",
            ingredients: ["Sashimi-grade tuna", "green pipián", "pico de gallo", "red jalapeño chili oil", "fried garlic"],
            history: "A modern creation from coastal regions like Baja California, blending the Mexican tostada with Japanese-influenced raw fish preparations.",
            allergens: ["fish", "sesame"], pairingTags: ['raw_fish', 'citrus', 'light', 'elegant', 'nutty']
        },
        {
            id: 5, name: "FILLET TATAKI", category: "Small Plates",
            description: "Lightly seared aged beef fillet in a chilmole marinade, sliced and served with a zesty black aguachile and a purée of 'toreados' (blistered chiles).",
            ingredients: ["Aged beef fillet", "chilmole marinade", "black aguachile", "toreados purée"],
            history: "Tataki is a Japanese searing technique. Here, it's fully embraced by Mexican flavors like chilmole, a dark, smoky paste from the Yucatán Peninsula.",
            allergens: ["soybeans", "fish"], pairingTags: ['beef', 'raw_beef', 'smoky', 'elegant', 'umami']
        },
        {
            id: 6, name: "STONE BASS TIRADITO", category: "Small Plates",
            description: "Thin slices of fresh stone bass, lightly cured in a vibrant aguachile of mango, grapefruit, lime, and red chili. A refreshing and citrus-forward dish.",
            ingredients: ["Stone bass", "mango", "grapefruit", "lime", "red chili", "orange aguachile"],
            history: "Tiradito is a Peruvian dish reflecting Japanese influence, similar to sashimi. It has been widely adopted in Mexico, where aguachile provides the perfect zesty marinade.",
            allergens: ["fish"], pairingTags: ['raw_fish', 'citrus', 'light', 'fruity', 'spicy']
        },
        {
            id: 26, name: "ISLE OF WIGHT TOMATOES", category: "Small Plates",
            description: "A celebration of British produce with a Mediterranean-Mexican twist. Sweet Isle of Wight tomatoes are paired with creamy ricotta, sharp Kalamata olives, and a bright leek oil and lemon dressing.",
            ingredients: ["Leek oil", "seasonal tomato", "Ricotta cheese", "red onion", "Kalamata olive", "olive oil", "oregano", "lemon juice"],
            history: "This dish highlights the modern culinary trend of using high-quality, local seasonal produce within a global flavor framework. It's a nod to both Italian Caprese salads and Mexican 'ensaladas frescas'.",
            allergens: ["milk"], pairingTags: ['starter', 'vegetarian', 'fresh', 'light', 'tomato']
        },
        // Del Comal
        {
            id: 7, name: "ENSENADA TACO", category: "Del Comal",
            description: "A classic Baja California fish taco. Beer-battered fish is fried until golden and served in a tortilla with pickled vegetables and a creamy, spicy scotch bonnet mayonnaise.",
            ingredients: ["Fish", "beer tempura", "pickled cucumber", "pickled carrot", "scotch bonnet mayonnaise"],
            history: "Born in the port city of Ensenada, the fish taco is a hallmark of Baja cuisine, celebrated for its perfect contrast of crispy fish, soft tortilla, and tangy toppings.",
            allergens: ["fish", "gluten", "eggs", "mustard"], pairingTags: ['taco', 'seafood', 'fried', 'spicy', 'creamy']
        },
        {
            id: 8, name: "ROASTED BEETROOT TACO", category: "Del Comal",
            description: "An earthy and complex vegetarian taco. Roasted beetroot is paired with pumpkin purée, smoked almonds, and a tangy pink labneh.",
            ingredients: ["Beetroot", "pumpkin purée", "smoked almonds", "pink labneh"],
            history: "This taco showcases a modern, vegetable-forward approach to Mexican cuisine, using traditional ingredients like pumpkin seeds in new and creative ways.",
            allergens: ["nuts", "milk"], pairingTags: ['taco', 'vegetarian', 'earthy', 'nutty']
        },
        {
            id: 9, name: "PRAWN ADOBADO QUESADILLA", category: "Del Comal",
            description: "A cheesy quesadilla packed with shrimp marinated in a smoky 'adobo enchilado', with refried beans and a creamy morita chili mayo.",
            ingredients: ["Shrimp", "adobo enchilado", "mix cheese", "refried beans", "morita chili mayo"],
            history: "Quesadillas from coastal states often feature fresh seafood. The adobo marinade adds a deep, smoky flavor that pairs perfectly with melted cheese.",
            allergens: ["crustaceans", "gluten", "milk", "eggs"], pairingTags: ['seafood', 'rich', 'smoky', 'comfort', 'cheesy']
        },
        {
            id: 10, name: "SHORT RIB QUESADILLA", category: "Del Comal",
            description: "A comforting and rich quesadilla filled with slow-braised short rib and a blend of cheeses. Served with molcajete and pineapple sauces for a balance of smoky and sweet.",
            ingredients: ["Short rib", "cheese blend", "molcajete sauce", "pineapple sauce"],
            history: "Combining the indigenous tortilla with Spanish cheese and slow-cooking techniques, this dish transforms a simple snack into a hearty meal.",
            allergens: ["gluten", "milk"], pairingTags: ['beef', 'rich', 'smoky', 'comfort', 'cheesy']
        },
        {
            id: 20, name: "PORK RIB TACO", category: "Del Comal",
            description: "Tender, slow-cooked pork rib with a sweet and spicy chili glaze, served in a soft tortilla with creamy avocado purée and fresh herbs.",
            ingredients: ["Pork rib", "chilli glaze", "avocado purée", "micro basil", "micro mint", "pickled radishes"],
            history: "This taco elevates the humble rib into a gourmet experience, using classic Mexican glazing techniques to create a sticky, flavorful coating that contrasts with fresh herbs.",
            allergens: [], pairingTags: ['pork', 'rich', 'sweet', 'taco', 'herbal']
        },
        // Platos Fuertes
        {
            id: 11, name: "PORK PASTOR", category: "Platos Fuertes",
            description: "A quintessential Mexico City dish. Pork is marinated in a traditional 'adobo' of chiles and spices, then slow-cooked. Served with grilled pineapple and salsas.",
            ingredients: ["Pork", "pastor adobo", "grilled pineapple", "onion", "tomatillo salsa"],
            history: "The 'al pastor' method was brought to Mexico by Lebanese immigrants, who adapted their shawarma spit-grill to local ingredients, creating a new culinary icon.",
            allergens: [], pairingTags: ['pork', 'spicy', 'sweet', 'robust', 'grilled']
        },
        {
            id: 12, name: "GRILLED STONE BASS", category: "Platos Fuertes",
            description: "Perfectly grilled stone bass with a delicate, flaky texture. It's served over a sophisticated pistachio pipián and garnished with a fresh herb salad and Mexican dukkah.",
            ingredients: ["Stone bass", "pistachio pipián", "Mexican dukkah", "mint", "basil", "cilantro"],
            history: "Pipián is a pre-Hispanic sauce made from ground nuts or seeds. Using pistachios is a modern gourmet twist on this ancient tradition.",
            allergens: ["fish", "nuts"], pairingTags: ['white_fish', 'nutty', 'herbal', 'elegant', 'grilled']
        },
        {
            id: 13, name: "SHORT RIB", category: "Platos Fuertes",
            description: "A succulent, slow-cooked short rib with a rich beef glaze. Served with a fresh pineapple salsa and a smoky barbecue sauce.",
            ingredients: ["Short rib", "beef glaze", "pineapple salsa", "barbecue sauce"],
            history: "Slow-cooking tough cuts of meat like short rib is a technique perfected in many cuisines. In Mexico, it's often paired with fruity or spicy salsas to cut through the richness.",
            allergens: ["celery", "sulphites"], pairingTags: ['beef', 'rich', 'braised', 'robust', 'sweet']
        },
        {
            id: 14, name: "LAMB", category: "Platos Fuertes",
            description: "Tender braised lamb in a deep reduction sauce, accompanied by a spicy 'salsa borracha' (drunken salsa) and a pickled cucumber and onion salsa.",
            ingredients: ["Braised lamb", "lamb reduction sauce", "salsa borracha", "pickled cucumber"],
            history: "Lamb barbacoa is a celebratory dish in central Mexico. This refined version uses classic braising techniques and serves it with complex salsas, including one made with beer or pulque.",
            allergens: ["sulphites", "gluten"], pairingTags: ['lamb', 'rich', 'braised', 'robust', 'spicy']
        },
        {
            id: 15, name: "CAULIFLOWER", category: "Platos Fuertes",
            description: "A whole roasted cauliflower served as a stunning centerpiece, flavored with salsa macha and morita chili mayo, all sitting in a savory vegetable jus.",
            ingredients: ["Roasted cauliflower", "salsa macha", "morita chili mayo", "veggie jus"],
            history: "Whole-roasted vegetables have become a star in modern cuisine. This dish gives cauliflower the main-course treatment with bold, nutty, and spicy Mexican sauces.",
            allergens: ["nuts", "sesame", "eggs", "mustard"], pairingTags: ['vegetarian', 'main', 'roasted', 'spicy', 'rich']
        },
        {
            id: 21, name: "HALF GRILLED CHICKEN", category: "Platos Fuertes",
            description: "A juicy, perfectly grilled half chicken marinated in adobo enchilado, finished with a savory chicken glaze and topped with pickled red onions.",
            ingredients: ["Half chicken", "adobo enchilado", "chicken glaze", "pickled red onion"],
            history: "Grilled chicken is a staple across Mexico. The use of an adobo marinade infuses the meat with layers of chili and spice before it even hits the grill, ensuring flavor in every bite.",
            allergens: [], pairingTags: ['chicken', 'grilled', 'spicy', 'robust']
        },
        {
            id: 22, name: "T BONE", category: "Platos Fuertes",
            description: "A magnificent T-bone steak marinated in cilantro, grilled to perfection, and served with grilled chilies for a classic, hearty experience.",
            ingredients: ["T-bone", "coriander marinade", "grilled chilies"],
            history: "While steak is universal, the use of a cilantro-heavy marinade is characteristic of Northern Mexican 'carne asada' culture, where grilling large cuts of beef is a social event.",
            allergens: [], pairingTags: ['beef', 'grilled', 'robust', 'herbal']
        },
        // De La Milpa
        {
            id: 23, name: "CRISPY POTATOES", category: "De La Milpa",
            description: "Perfectly crispy potatoes served with a vibrant green salsa and a smoky morita mayonnaise for dipping.",
            ingredients: ["Potatoes", "green salsa", "morita mayonnaise"],
            history: "A beloved side dish, 'papas' are a staple in Mexican cuisine. This version elevates them with two classic salsas, offering both fresh and smoky flavors.",
            allergens: ["eggs", "mustard"], pairingTags: ['side', 'vegetarian', 'fried', 'spicy']
        },
        {
            id: 24, name: "LEAVES SALAD", category: "De La Milpa",
            description: "A refreshing and complex salad with bitter radicchio, escarole, sweet pear, and smoked almonds, all tossed in a bright preserved lemon vinaigrette.",
            ingredients: ["Radicchio", "escarole lettuce", "smoked almonds", "pear", "preserved lemon vinaigrette"],
            history: "This salad is a modern interpretation of a side dish, balancing bitter, sweet, smoky, and acidic elements in a way that perfectly complements richer main courses.",
            allergens: ["nuts"], pairingTags: ['side', 'vegetarian', 'fresh', 'light']
        },
        {
            id: 25, name: "QUESO FUNDIDO", category: "De La Milpa",
            description: "A decadent bowl of molten Comté and mozzarella cheese, topped with savory roasted chorizo and fresh chives. Perfect for sharing.",
            ingredients: ["Comté cheese", "mozzarella cheese", "roasted chorizo", "fresh chives"],
            history: "'Melted cheese' is a classic Northern Mexican appetizer, traditionally cooked in a cast-iron skillet and served with tortillas. Our version uses a blend of European cheeses for extra depth.",
            allergens: ["milk"], pairingTags: ['side', 'rich', 'cheesy', 'comfort']
        },
        // Desserts
        {
            id: 16, name: "TRES LECHES CAKE", category: "Desserts",
            description: "A light sponge cake soaked in a decadent mixture of three milks. Topped with cinnamon custard cream, fresh strawberries, and a crispy corn meringue.",
            ingredients: ["Sponge cake", "evaporated milk", "condensed milk", "cream", "cinnamon custard", "strawberry"],
            history: "A beloved cake for celebrations across Latin America, likely popularized by dairy companies on their canned milk labels in the 20th century.",
            allergens: ["gluten", "eggs", "milk"], pairingTags: ['dessert', 'creamy', 'sweet', 'classic']
        },
        {
            id: 17, name: "MANGO CHAMOY", category: "Desserts",
            description: "A refreshing and exciting dessert featuring fresh mango with chamoy (a salty, sweet, sour, and spicy condiment) and a sharp lime sorbet.",
            ingredients: ["Fresh mango", "chamoy", "lime sorbet", "Tajín chili powder"],
            history: "This dish captures the essence of Mexican street food snacks, where fresh fruit is commonly dressed with lime, salt, chili, and chamoy for a multi-layered flavor explosion.",
            allergens: [], pairingTags: ['dessert', 'fruity', 'spicy', 'light', 'sour']
        }
    ];

    // Expanded Wine Menu with Pairing Profiles
    const wineMenu = [
        { 
            id: 101, name: "Albarino Sobre Lias, Casal Caeiro", type: "White", price: 67, 
            sommelierNotes: { appearance: "Clear, pale lemon-green.", nose: "Aromas of grapefruit, lime, white peach, and a distinct saline, mineral note.", palate: "Dry, high acidity, light body. Flavors of green apple and citrus zest, with a creamy texture from lees aging.", summary: "A classic, vibrant Albariño, exceptionally food-friendly." }
        },
        { 
            id: 102, name: "Sauvignon Blanc, Dog Point", type: "White", price: 70, 
            sommelierNotes: { appearance: "Clear, pale lemon.", nose: "Aromas of passionfruit, gooseberry, and a hint of fresh-cut grass.", palate: "Dry, high acidity, medium body. Intense flavors of tropical fruit and citrus, with a crisp finish.", summary: "An exemplary Marlborough Sauvignon Blanc." }
        },
        {
            id: 103, name: "Gewurztraminer, Cave de Cléebourg", type: "White", price: 61,
            sommelierNotes: { appearance: "Clear, pale gold.", nose: "Intensely aromatic with notes of lychee, rose petals, and a hint of ginger.", palate: "Off-dry, with a rich, slightly oily texture, medium acidity, and a long, perfumed finish.", summary: "An aromatic powerhouse, perfect for spicy and sweet flavor profiles."}
        },
        {
            id: 104, name: "Vermentino, Quatre Vin Organic Blanc", type: "White", price: 66,
            sommelierNotes: { appearance: "Pale straw with green hints.", nose: "Delicate aromas of white flowers, green pear, and a touch of bitter almond.", palate: "Dry, refreshing acidity, light to medium body. Crisp with a clean, slightly saline finish.", summary: "A quintessential Provence white, perfect for light starters."}
        },
        {
            id: 105, name: "Grüner Veltliner Federspiel, Rudi Pichler", type: "White", price: 78.7,
            sommelierNotes: { appearance: "Bright, pale yellow.", nose: "Signature notes of white pepper, radish, and green apple.", palate: "Dry, zesty acidity, medium body. Structured and mineral-driven with a spicy finish.", summary: "A classic Grüner that can handle spice and fried foods."}
        },
        {
            id: 107, name: "Sancerre La Croix du Roy, Crochet", type: "White", price: 98,
            sommelierNotes: { appearance: "Pale lemon.", nose: "Aromas of peach, pear, citrus, and a distinct flinty, smoky minerality.", palate: "Dry, high acidity, medium body. Elegant and restrained with a long, mineral finish.", summary: "A sophisticated and mineral-driven Sauvignon Blanc from its spiritual home."}
        },
        { 
            id: 108, name: "Riesling Cole Ranch, Cobb", type: "White", price: 138,
            sommelierNotes: { appearance: "Pale lemon.", nose: "Developing notes of lime peel, white peach, and a characteristic wet stone or petrol aroma.", palate: "Dry, high acidity, light body. Laser-like focus with intense citrus and mineral flavors.", summary: "A complex, age-worthy Riesling with incredible precision."}
        },
        { 
            id: 106, name: "Châteauneuf-du-Pape Blanc, Dom de Beaurenard", type: "White", price: 178,
            sommelierNotes: { appearance: "Medium gold.", nose: "Complex aromas of apricot, pear, fennel, and honeysuckle.", palate: "Dry, full-bodied, with a rich, textured mouthfeel and balanced acidity. Long, complex finish.", summary: "A rare and powerful white, offering incredible complexity for rich fish or pork." }
        },
        { 
            id: 201, name: "Tempranillo, Rioja Crianza Conde Valdemar", type: "Red", price: 51, 
            sommelierNotes: { appearance: "Clear, medium ruby.", nose: "Aromas of red cherry, raspberry, vanilla, clove, and a touch of leather.", palate: "Dry, medium acidity, smooth tannins. Flavors of ripe red fruit and sweet spice.", summary: "A benchmark Rioja Crianza that beautifully balances fruit and oak." }
        },
        { 
            id: 209, name: "Barbera d'Alba DOC, Fratelli Antonio e Raimondo", type: "Red", price: 56,
            sommelierNotes: { appearance: "Deep ruby.", nose: "Aromas of sour cherry, plum, and a hint of clove.", palate: "Dry, high acidity, low tannins. Juicy and fresh with a vibrant fruit character.", summary: "A food-friendly Italian red with bright acidity."}
        },
        { 
            id: 202, name: "Pinot Noir IX, Pulenta Estate", type: "Red", price: 71.4, 
            sommelierNotes: { appearance: "Clear, pale ruby.", nose: "Aromas of fresh red cherry, strawberry, and floral notes of violet.", palate: "Dry, high acidity, silky tannins. Pure red fruit flavors and a fresh, elegant finish.", summary: "A vibrant, high-altitude Pinot Noir." }
        },
        {
            id: 204, name: "Malbec Rose, Finca La Colonia", type: "Rosé", price: 51.5,
            sommelierNotes: { appearance: "Bright pink.", nose: "Fresh aromas of strawberries and red cherries.", palate: "Dry, crisp acidity, light body. Refreshing with a clean finish.", summary: "A versatile and refreshing rosé."}
        },
        {
            id: 205, name: "Mucchietto Primitivo IGT Puglia 2022", type: "Red", price: 61,
            sommelierNotes: { appearance: "Deep ruby red.", nose: "Intense aromas of ripe dark berries, plum jam, and sweet spices.", palate: "Dry, full-bodied with soft tannins. Rich and warming with a hint of dark chocolate.", summary: "A bold, fruit-forward red for hearty dishes."}
        },
        {
            id: 208, name: "Cabernet Franc Galantas Gran Reserva, Haras de Pirque", type: "Red", price: 90,
            sommelierNotes: { appearance: "Deep ruby.", nose: "Aromas of blueberry, blackberry, with a distinct herbal, bell pepper note and a touch of mineral.", palate: "Dry, medium-full body, with structured tannins and a savory, herbal finish.", summary: "An elegant and structured red with a unique savory character."}
        },
        { 
            id: 206, name: "Volnay 1er Cru Le Ronceret, Dom Georges Glantenay", type: "Red", price: 252,
            sommelierNotes: { appearance: "Pale to medium ruby.", nose: "Elegant aromas of blackberry, violets, and a flinty, mineral character.", palate: "Dry, high acidity, fine-grained tannins. A silky texture with a long, complex finish.", summary: "The epitome of elegant Burgundy, for refined meat dishes." }
        },
        { 
            id: 207, name: "Château Talbot, Saint-Julien", type: "Red", price: 310,
            sommelierNotes: { appearance: "Deep garnet.", nose: "Classic Bordeaux nose of blackcurrant, tobacco leaf, cedar, and espresso.", palate: "Dry, full-bodied with firm, structured tannins. Powerful and long, with layers of savory and dark fruit notes.", summary: "A classic, powerful Bordeaux for the most robust dishes." }
        },
        { 
            id: 301, name: "Sauvignon Blanc Late Harvest, Morandė", type: "Sweet", price: 32.5, 
            sommelierNotes: { appearance: "Clear, deep gold.", nose: "Aromas of honey, candied pineapple, apricot jam, and orange blossom.", palate: "Lusciously sweet, with high acidity that provides perfect balance.", summary: "A beautiful sweet wine where acidity perfectly balances richness." }
        },
    ];

    // Cocktail Menu
    const cocktailMenu = [
        { id: 401, name: "Tommy's Margarita", price: 16.8, ingredients: ["818 Blanco Tequila", "Lime Juice", "Organic Agave"], history: "Created in the 1990s by Julio Bermejo at Tommy's Mexican Restaurant in San Francisco, it swaps orange liqueur for agave nectar for a purer flavor.", tastingNotes: "Sour, fresh, and citric. A clean and direct expression of tequila." },
        { id: 402, name: "Mezcalita", price: 17.5, ingredients: ["Casamigos Mezcal", "Lime Juice", "Natural Agave"], history: "A simple twist on the Margarita, substituting tequila's smoky cousin, mezcal, for a deeper, earthier flavor experience.", tastingNotes: "Smoky, rich, and citric. A powerful and complex cocktail." },
        { id: 403, name: "Paloma", price: 15.7, ingredients: ["818 Blanco Tequila", "Cointreau", "Three Cents Grapefruit Soda"], history: "Arguably Mexico's most popular cocktail. A simple, refreshing, and perfectly balanced staple in bars across the country.", tastingNotes: "Clean, zesty, and fresh. The ultimate thirst-quencher." },
        { id: 404, name: "Ixchel Negroni", price: 17.8, ingredients: ["818 Reposado Tequila", "Melon and honey infused Campari", "Martini Rubino"], history: "A modern, house twist on the Italian classic, using aged reposado tequila instead of gin for an earthy depth.", tastingNotes: "Bitter, fruity, and sour. A complex and intriguing variation." },
        { id: 405, name: "Horchata", price: 16.8, ingredients: ["Vivir Cafe", "Rice Milk", "Cinnamon"], history: "Inspired by the traditional Mexican rice milk drink, this alcoholic version turns the beloved 'agua fresca' into a creamy after-dinner cocktail.", tastingNotes: "Sweet, creamy, and nutty. A delicious liquid dessert." },
        { id: 406, name: "Spicy white peach", price: 16.8, ingredients: ["818 blanco", "white peach puree", "red jalapeño sauce", "lime juice", "natural agave"], history: "A modern margarita variation that balances sweet, spicy, and creamy elements for a complex and seductive cocktail experience.", tastingNotes: "Spicy, creamy, and smooth with a fruity backbone." },
        { id: 407, name: "Blood Orange Sour", price: 16.8, ingredients: ["Lost explorer espadin", "mayan orange liqueur", "lime juice", "egg white", "blood orange puree", "organic agave syrup"], history: "A vibrant sour that uses smoky mezcal as its base, with the deep citrus flavor of blood orange creating a visually stunning and delicious drink.", tastingNotes: "Fresh, zesty, and sour with a smoky undertone." },
        { id: 408, name: "Avocado Margarita", price: 17.5, ingredients: ["Casamigos blanco", "lime juice", "avocado", "mexican corn liquor", "organic agave"], history: "A creative twist that incorporates avocado for an incredibly smooth, creamy texture, transforming the classic margarita into a richer experience.", tastingNotes: "Sweet, rich, and smooth with a unique creamy body." },
        { id: 409, name: "Tequila Sour", price: 15.7, ingredients: ["818 blanco", "disaronno amaretto", "lime juice", "house chilli syrup"], history: "A Mexican take on the classic sour, this version adds the nutty sweetness of amaretto and a house-made chili syrup for a smoky, spicy kick.", tastingNotes: "Smoky, creamy, and earthy with a sweet and spicy finish." }
    ];
    
    // --- APPLICATION LOGIC ---

    const foodMenuContainer = document.getElementById('food-menu-container');
    const pairingModal = document.getElementById('pairing-modal');
    const modalContent = document.getElementById('modal-content');

    // Function to render the food menu
    function renderFoodMenu() {
        foodMenuContainer.innerHTML = '';
        const categories = [...new Set(foodMenu.map(item => item.category))];
        
        categories.forEach(category => {
            const categorySection = document.createElement('section');
            categorySection.className = 'mb-16';
            const categoryTitle = document.createElement('h2');
            categoryTitle.className = 'text-4xl font-serif font-bold text-amber-800 border-b-2 border-amber-200 pb-3 mb-8';
            categoryTitle.textContent = category;
            categorySection.appendChild(categoryTitle);
            const itemsGrid = document.createElement('div');
            itemsGrid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8';
            
            foodMenu.filter(item => item.category === category).forEach(item => {
                const allergensHtml = item.allergens.map(allergenKey => {
                    const allergen = ALLERGENS_UK[allergenKey];
                    return `<div class="allergen-icon" title="${allergen.name}">
                                ${allergen.icon}
                                <span class="allergen-tooltip">${allergen.name}</span>
                            </div>`;
                }).join('');

                const itemCard = document.createElement('div');
                itemCard.className = 'dish-card bg-white p-6 rounded-xl shadow-lg flex flex-col';
                itemCard.innerHTML = `
                    <h3 class="text-2xl font-serif font-bold mb-3 text-stone-900">${item.name}</h3>
                    <p class="text-stone-600 mb-5 flex-grow">${item.description}</p>
                    <div class="mb-5">
                        <h4 class="font-semibold text-sm mb-2 text-stone-500">Allergens:</h4>
                        <div class="flex flex-wrap">${allergensHtml || '<span class="text-stone-500 text-sm">None</span>'}</div>
                    </div>
                    <button onclick="showPairingModal(${item.id})" class="mt-auto w-full bg-amber-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-amber-700 transition-all duration-300 shadow-md hover:shadow-lg">
                        Details & Sommelier
                    </button>
                `;
                itemsGrid.appendChild(itemCard);
            });
            categorySection.appendChild(itemsGrid);
            foodMenuContainer.appendChild(categorySection);
        });
    }

    // ** REVISED Pairing Logic **
    const pairingMap = {
        1: { wines: { byGlass: 104, midRange: 102, premium: 108 }, cocktails: [408, 403] }, // Guacamole
        2: { wines: { byGlass: 101, midRange: 105, premium: 106 }, cocktails: [409, 403] }, // Focaccia
        3: { wines: { byGlass: 101, midRange: 105, premium: 106 }, cocktails: [406, 403] }, // Rock Shrimp
        4: { wines: { byGlass: 104, midRange: 107, premium: 108 }, cocktails: [401, 407] }, // Tuna Tostada
        5: { wines: { byGlass: 204, midRange: 202, premium: 206 }, cocktails: [402, 409] }, // Fillet Tataki
        6: { wines: { byGlass: 101, midRange: 102, premium: 107 }, cocktails: [401, 403] }, // Stone Bass Tiradito
        7: { wines: { byGlass: 101, midRange: 105, premium: 106 }, cocktails: [403, 401] }, // Ensenada Taco
        8: { wines: { byGlass: 204, midRange: 102, premium: 208 }, cocktails: [403, 402] }, // Beetroot Taco
        9: { wines: { byGlass: 101, midRange: 105, premium: 106 }, cocktails: [406, 407] }, // Prawn Quesadilla
        10: { wines: { byGlass: 209, midRange: 201, premium: 208 }, cocktails: [402, 404] }, // Short Rib Quesadilla
        11: { wines: { byGlass: 103, midRange: 202, premium: 206 }, cocktails: [402, 407] }, // Pork Pastor
        12: { wines: { byGlass: 104, midRange: 107, premium: 106 }, cocktails: [401, 403] }, // Grilled Stone Bass
        13: { wines: { byGlass: 201, midRange: 205, premium: 207 }, cocktails: [402, 404] }, // Short Rib
        14: { wines: { byGlass: 201, midRange: 208, premium: 207 }, cocktails: [402, 409] }, // Lamb
        15: { wines: { byGlass: 103, midRange: 105, premium: 106 }, cocktails: [406, 402] }, // Cauliflower
        16: { wines: { byGlass: 301, midRange: null, premium: null }, cocktails: [405] }, // Tres Leches
        17: { wines: { byGlass: 301, midRange: null, premium: null }, cocktails: [401] },  // Mango Chamoy
        20: { wines: { byGlass: 209, midRange: 205, premium: 208 }, cocktails: [402, 404] }, // Pork Rib Taco
        21: { wines: { byGlass: 104, midRange: 202, premium: 106 }, cocktails: [403, 409] }, // Half Chicken
        22: { wines: { byGlass: 201, midRange: 205, premium: 207 }, cocktails: [402, 404] }, // T-Bone
        23: { wines: { byGlass: 101, midRange: 105, premium: null }, cocktails: [403, 401] }, // Crispy Potatoes
        24: { wines: { byGlass: 104, midRange: 102, premium: 107 }, cocktails: [403, 401] }, // Leaves Salad
        25: { wines: { byGlass: 209, midRange: 201, premium: 205 }, cocktails: [402, 404] }, // Queso Fundido
        26: { wines: { byGlass: 104, midRange: 107, premium: 108 }, cocktails: [403, 401] } // Isle of Wight Tomatoes
    };

    function findPairings(dishId) {
        const pairings = pairingMap[dishId] || { wines: { byGlass: null, midRange: null, premium: null }, cocktails: [] };
        return {
            wines: {
                byGlass: wineMenu.find(w => w.id === pairings.wines.byGlass),
                midRange: wineMenu.find(w => w.id === pairings.wines.midRange),
                premium: wineMenu.find(w => w.id === pairings.wines.premium)
            },
            cocktails: pairings.cocktails.map(id => cocktailMenu.find(c => c.id === id))
        };
    }
    
    // ** REVISED getPairingReason function **
    function getPairingReason(drink, dish) {
        const reasons = {
            'd1-dr104': "The Vermentino's crisp acidity and notes of green pear provide a clean, refreshing counterpoint to the rich creaminess of the avocado.",
            'd1-dr102': "The Sauvignon Blanc's zesty passionfruit and herbal notes amplify the fresh cilantro and lime in the guacamole, creating a vibrant synergy.",
            'd1-dr108': "The Riesling's high acidity cuts through the richness of the avocado, while its complex notes of wet stone and lime peel complement the dish's zesty profile.",
            'd1-dr408': "This cocktail's creamy avocado base creates a luxurious texture-on-texture pairing, while the lime and corn liqueur lift the finish.",
            'd1-dr403': "The Paloma's grapefruit soda provides a zesty, slightly bitter counterpoint to the rich avocado, cleansing the palate with every sip.",
            'd2-dr101': "The Albariño's high acidity cuts through the richness of the seaweed butter and guajillo oil, while its saline notes complement the umami flavors.",
            'd2-dr105': "The wine's zesty acidity and peppery notes cut through the richness of the bread and butter, while complementing the savory leek and salsa macha.",
            'd2-dr106': "The full body and complex notes of fennel and apricot in this powerful white wine stand up to the umami-rich seaweed butter and the heat from the guajillo oil.",
            'd2-dr409': "The Tequila Sour's chili syrup echoes the guajillo oil's spice, while the amaretto's sweetness provides a pleasant contrast to the savory bread.",
            'd2-dr403': "The Paloma's bright grapefruit and effervescence provide a refreshing lift, cleansing the palate from the rich focaccia and its savory toppings.",
            'd3-dr101': "The Albariño's high acidity and saline character cut cleanly through the richness of the tempura batter, while its citrus notes lift the sweet shrimp.",
            'd3-dr105': "The Grüner Veltliner's characteristic white pepper note is a fantastic match for the adobo spice, and its zesty acidity handles the fried element with ease.",
            'd3-dr106': "This rich, full-bodied white has the texture and complexity to match the creamy avocado dressing and the spicy adobo on the shrimp without being overshadowed.",
            'd3-dr406': "The cocktail's creamy peach sweetness envelops the shrimp, while the jalapeño heat provides a thrilling contrast that matches the adobo's spice.",
            'd3-dr403': "The zesty and slightly bitter grapefruit soda cuts through the richness of the fried tempura, offering a refreshing and clean contrast to the spicy shrimp.",
            'd4-dr107': "The Sancerre's elegant, flinty minerality provides a sophisticated backdrop for the raw tuna, while its restrained citrus notes complement without overpowering.",
            'd4-dr108': "The Riesling's laser-like acidity and notes of lime peel are a perfect match for the raw tuna, while its subtle minerality enhances the nutty green pipián sauce.",
            'd4-dr401': "The pure agave and lime in the Tommy's Margarita act almost like a ceviche marinade for the tuna, enhancing its freshness without overpowering it.",
            'd4-dr407': "The smoky mezcal in the sour provides a beautiful contrast to the fresh tuna, while the blood orange acidity complements the green pipián.",
            'd5-dr204': "The Rosé's bright acidity cuts through the richness of the seared fillet, while its red berry notes offer a beautiful contrast to the smoky chilmole marinade.",
            'd5-dr202': "The Pinot Noir's earthy undertones and bright red fruit are a superb match for the smoky chilmole marinade and the seared beef.",
            'd5-dr206': "A truly elegant pairing. The Volnay's silky tannins, floral notes, and flinty minerality elevate the delicate beef without overpowering it.",
            'd5-dr402': "The deep smokiness of the Mezcalita perfectly mirrors the smoky chilmole marinade on the beef, creating a powerful and synergistic pairing.",
            'd5-dr409': "The Tequila Sour's smoky chili syrup resonates with the chilmole marinade, while the amaretto's nutty sweetness provides a surprising and delicious counterpoint.",
            'd6-dr101': "The Albariño's vibrant grapefruit and lime notes perfectly mirror the citrus in the aguachile, creating a seamless and refreshing pairing.",
            'd6-dr102': "The Sauvignon Blanc's tropical fruit notes enhance the mango in the dish, while its high acidity matches the intensity of the aguachile.",
            'd6-dr107': "The Sancerre's flinty minerality and high acidity beautifully complement the delicate raw fish, while its citrus notes harmonize with the grapefruit aguachile.",
            'd6-dr401': "The pure, sharp lime and agave notes of a Tommy's act as an extension of the aguachile marinade, enhancing the dish's vibrant citrus profile.",
            'd6-dr403': "The grapefruit soda in the Paloma echoes the grapefruit in the aguachile, creating a seamless, refreshing, and zesty fruit-forward pairing.",
            'd7-dr101': "The Albariño's high acidity and saline character cut through the beer batter and creamy mayonnaise, while its citrus notes lift the fresh fish.",
            'd7-dr105': "Grüner's peppery spice is a great match for the scotch bonnet mayo, while its acidity cleanses the palate from the fried fish.",
            'd7-dr106': "The wine's full body and rich texture can stand up to the fried batter and spicy mayonnaise, while its stone fruit notes complement the fish.",
            'd7-dr403': "A Paloma is a quintessential taco companion. Its effervescence and grapefruit zest are incredibly refreshing against the fried fish and spicy mayo.",
            'd7-dr401': "The classic choice. The sharp lime cuts through the richness, while the tequila complements the flavors of the corn tortilla.",
            'd8-dr204': "The rosé's bright strawberry notes provide a fruity lift to the earthy beetroot, while its crisp acidity balances the creamy labneh.",
            'd8-dr102': "The wine's herbal, grassy notes are a fantastic complement to the earthy beetroot, creating a pairing that is vibrant and fresh.",
            'd8-dr208': "The Cabernet Franc's subtle pyrazine (bell pepper) and herbal notes are a fantastic complement to the earthy beetroot, creating a savory, garden-fresh pairing.",
            'd8-dr403': "The zesty grapefruit of the Paloma cuts through the earthy beetroot and rich labneh, adding a bright and refreshing citrus dimension.",
            'd8-dr402': "The smokiness of the mezcal provides a stunning contrast to the sweet, earthy beetroot and complements the smoked almonds in the dish.",
            'd9-dr101': "The saline notes and high acidity of the Albariño cut through the rich cheese and complement the prawns, while cleansing the palate from the adobo spice.",
            'd9-dr105': "Grüner Veltliner's peppery spice enhances the smoky morita chili mayo, and its acidity provides a refreshing counterpoint to the cheesy filling.",
            'd9-dr106': "The Châteauneuf-du-Pape Blanc's full body and stone fruit notes can handle the richness of the quesadilla, with its complexity matching the smoky adobo.",
            'd9-dr406': "The Spicy White Peach Margarita's heat and fruitiness are a bold match for the prawn adobo, with its creamy texture complementing the melted cheese.",
            'd9-dr407': "The smoky mezcal and zesty blood orange in the sour cut through the richness of the cheese, while complementing the smoky adobo of the prawns.",
            'd10-dr209': "The Barbera's high acidity cuts through the richness of the cheese and short rib, while its sour cherry notes provide a lovely contrast to the smoky molcajete sauce.",
            'd10-dr201': "The vanilla and spice notes from the Rioja's oak aging are a perfect match for the slow-braised short rib and smoky sauces.",
            'd10-dr208': "The wine's savory, herbal notes provide a beautiful contrast to the sweet pineapple salsa, while its tannins cut through the rich beef and cheese.",
            'd10-dr402': "The smoky Mezcalita enhances the flavor of the molcajete sauce and the rich short rib, a classic pairing for savory Mexican dishes.",
            'd10-dr404': "The Negroni's characteristic bitterness provides a sophisticated counterpoint to the rich, cheesy short rib, cleansing the palate.",
            'd11-dr103': "An unconventional but brilliant pairing. The Gewurztraminer's notes of lychee and rose petal offer a stunning aromatic contrast to the savory adobo spice, while its off-dry character embraces the sweet pineapple.",
            'd11-dr202': "The Pinot Noir's bright red fruit and acidity cut through the richness of the pork, while its earthy notes complement the adobo spices.",
            'd11-dr206': "The elegant red fruit and floral notes of the Volnay provide a refined contrast to the bold flavors of the pork al pastor, elevating the dish.",
            'd11-dr402': "The smokiness of the mezcal is a natural partner for the spiced adobo pork and the char from the grill.",
            'd11-dr407': "The sour's smoky base and bright blood orange acidity are a perfect foil for the rich, spicy, and sweet notes of the pork al pastor.",
            'd12-dr104': "The Vermentino's clean, floral notes and hint of salinity are a delicate match for the grilled fish, allowing the nutty pistachio pipián to shine.",
            'd12-dr107': "The Sancerre's flinty minerality and restrained citrus notes provide an elegant framework that enhances the delicate flavor of the grilled bass without overwhelming the nutty pipián.",
            'd12-dr106': "The wine's full body, rich texture, and complex notes of fennel and apricot can stand up to the rich pistachio pipián and enhance the grilled fish.",
            'd12-dr401': "The pure, clean flavors of a Tommy's Margarita, with its sharp lime, act as a final squeeze of citrus over the grilled fish.",
            'd12-dr403': "The Paloma's refreshing grapefruit and effervescence cut through the richness of the pistachio pipián, cleansing the palate.",
            'd13-dr201': "The Rioja's savory leather and spice notes from oak aging are a classic match for the braised short rib, complementing the smoky barbecue sauce.",
            'd13-dr205': "The Primitivo's bold, jammy dark fruit and spice notes are a powerful match for the rich, glazed short rib, standing up to its intense flavor profile.",
            'd13-dr207': "An ultimate pairing for a rich dish. The Château Talbot's structured tannins and notes of blackcurrant and tobacco can stand shoulder-to-shoulder with the powerful short rib.",
            'd13-dr402': "The deep smoke of the mezcal is a perfect match for the smoky barbecue sauce and the rich, slow-cooked beef.",
            'd13-dr404': "The bitterness of our Ixchel Negroni cuts through the fat of the rib, while the aged tequila provides an earthy foundation that complements the smoky barbecue sauce.",
            'd14-dr201': "The Rioja's earthy and spicy notes are a traditional and excellent pairing for lamb, harmonizing with the rich reduction sauce.",
            'd14-dr208': "The Cabernet Franc's herbal and savory notes are a perfect match for the rich lamb, while its structured tannins stand up to the reduction sauce.",
            'd14-dr207': "The powerful structure and savory notes of tobacco and cedar in the Château Talbot are a magnificent partner for the robust braised lamb.",
            'd14-dr402': "The mezcal's smokiness complements the deep flavors of the braised lamb and the spicy 'salsa borracha'.",
            'd14-dr409': "The Tequila Sour's smoky chili notes echo the spice in the salsas, while its body stands up to the richness of the lamb.",
            'd15-dr103': "The Gewurztraminer's aromatic profile of rose and ginger is a bold and successful pairing for the spicy salsa macha, while its texture matches the richness of the dish.",
            'd15-dr105': "The Grüner Veltliner's peppery spice resonates with the salsa macha, and its acidity cuts through the creamy morita mayonnaise.",
            'd15-dr106': "This white wine's full body and complexity allow it to stand up to the bold, spicy, and nutty flavors of the roasted cauliflower dish.",
            'd15-dr406': "The cocktail's creamy texture and sweet peach notes provide a cooling contrast to the spicy salsa macha, while the jalapeño heat complements it.",
            'd15-dr402': "The smokiness of the Mezcalita is a natural pairing for the roasted notes of the cauliflower and the nutty, spicy salsa macha.",
            'd16-dr301': "This Late Harvest wine has notes of honey and candied pineapple that harmonize with the cake's sweetness, while its high acidity prevents the pairing from being overly cloying.",
            'd16-dr405': "A perfect match. The creamy, cinnamon notes of the Horchata cocktail mirror the flavors in the cake's custard, creating a seamless and decadent dessert experience.",
            'd17-dr301': "The wine's tropical fruit notes of pineapple and apricot jam enhance the fresh mango, while its sweetness is balanced by the tangy chamoy and lime sorbet.",
            'd17-dr401': "The Tommy's Margarita's sharp lime and clean agave flavor profile provides a fantastic citrusy counterpoint to the sweet mango and spicy Tajín.",
            'd20-dr209': "The Barbera's high acidity is perfect for cutting through the richness of the pork rib, while its sour cherry notes contrast the sweet chili glaze.",
            'd20-dr205': "The jammy dark fruit of the Primitivo is a great match for the sweet and sticky chili glaze, creating a rich, fruit-forward pairing.",
            'd20-dr208': "The savory and herbal notes of the Cabernet Franc offer a sophisticated contrast to the sweetness of the chili glaze, balancing the dish.",
            'd20-dr402': "The smokiness of the Mezcalita is a natural partner to the grilled pork, while its citrus notes cut through the richness of the chili glaze.",
            'd20-dr404': "The Negroni's bitterness is an excellent counterpoint to the sweet chili glaze on the pork, creating a complex and balanced pairing.",
            'd21-dr104': "The crisp Vermentino is refreshing against the grilled chicken, while its floral notes complement the adobo spices without overwhelming them.",
            'd21-dr202': "Pinot Noir is a versatile pairing for chicken. Its bright acidity and red fruit notes complement the adobo spice without being too heavy.",
            'd21-dr106': "A powerful white for a powerful bird. The Châteauneuf-du-Pape Blanc's rich texture and notes of stone fruit and fennel complement the adobo-marinated chicken beautifully.",
            'd21-dr403': "The Paloma’s refreshing grapefruit soda cuts through the richness of the chicken glaze and cools the palate from the adobo spice.",
            'd21-dr409': "The sour's smoky chili syrup echoes the adobo marinade, creating a harmonious spicy pairing, while the amaretto adds a sweet complexity.",
            'd22-dr201': "A classic steak pairing. The Rioja's vanilla and spice from oak aging complement the grilled meat, and its tannins match the protein.",
            'd22-dr205': "The bold fruit and soft tannins of the Primitivo are a great match for the rich T-bone, especially the char from the grill.",
            'd22-dr207': "A classic pairing. The bold structure, firm tannins, and blackcurrant notes of the Château Talbot are the perfect match for a high-quality T-bone steak.",
            'd22-dr402': "The deep smoke of the mezcal enhances the char-grilled flavor of the T-Bone, a classic pairing for grilled meats.",
            'd22-dr404': "The Negroni’s bitter profile provides a sophisticated contrast to the rich, fatty steak, while the herbal notes from the vermouth complement the cilantro marinade.",
            'd23-dr101': "The Albariño's high acidity and crispness are perfect for cutting through the fried potatoes and the creamy, smoky mayonnaise.",
            'd23-dr105': "The peppery spice of the Grüner Veltliner is a great match for the morita mayonnaise, and its zesty acidity is refreshing against the fried potatoes.",
            'd23-dr403': "The effervescent Paloma is the perfect palate cleanser for the crispy potatoes and rich morita mayonnaise.",
            'd23-dr401': "The sharp, clean lime of the Tommy's Margarita cuts beautifully through the fried potatoes and creamy mayonnaise.",
            'd24-dr104': "The wine's bright acidity matches the preserved lemon vinaigrette, while its floral notes complement the sweet pear and bitter greens.",
            'd24-dr102': "The Sauvignon Blanc's herbal notes harmonize with the salad greens, while its acidity stands up to the vinaigrette.",
            'd24-dr107': "The Sancerre's elegant minerality and citrus notes are a sophisticated match for this complex salad, especially the preserved lemon vinaigrette.",
            'd24-dr403': "The Paloma's grapefruit notes complement the preserved lemon vinaigrette and sweet pear in the salad.",
            'd24-dr401': "The Margarita's bright lime acidity harmonizes perfectly with the salad's vinaigrette, creating a light and zesty pairing.",
            'd25-dr209': "The Barbera's high acidity is essential for cutting through the molten cheese, while its sour cherry notes contrast with the savory chorizo.",
            'd25-dr201': "The Rioja's savory spice notes are a perfect match for the roasted chorizo, and its structure handles the rich cheese.",
            'd25-dr205': "The bold fruit of the Primitivo stands up to the intense flavors of the chorizo and rich cheese blend.",
            'd25-dr402': "The smoky Mezcalita cuts through the rich, molten cheese and beautifully complements the savory roasted chorizo.",
            'd25-dr404': "The Negroni's bitterness offers a welcome contrast to the intense richness of the queso fundido, cleansing the palate.",
            'd26-dr104': "The Vermentino's crisp, saline character is a perfect match for the fresh tomatoes, while its acidity balances the creamy ricotta.",
            'd26-dr107': "The Sancerre's minerality and high acidity cut through the richness of the olive oil and cheese, elevating the fresh tomato flavor.",
            'd26-dr108': "The Riesling's high acidity is a perfect foil for the tomatoes' acidity and the creamy ricotta, creating a vibrant and clean pairing.",
            'd26-dr401': "The clean, sharp lime of the Tommy's Margarita acts like a final squeeze of citrus over the salad, brightening all the flavors.",
            'd26-dr403': "The refreshing effervescence and citrus notes of the Paloma provide a lively contrast to the creamy ricotta and the sweetness of the tomatoes."
        };
        return reasons[`d${dish.id}-dr${drink.id}`];
    }

    // Function to show the pairing modal
    window.showPairingModal = function(dishId) {
        const dish = foodMenu.find(d => d.id === dishId);
        if (!dish) return;
        const pairings = findPairings(dishId);

        let pairingsHtml = `
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-start">
                    <h2 class="text-3xl md:text-4xl font-serif font-bold mb-4">${dish.name}</h2>
                    <button onclick="closeModal()" class="text-3xl text-stone-500 hover:text-stone-800">&times;</button>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-xl font-bold mb-2 border-b border-amber-200 pb-2 text-amber-800">Dish Description</h3>
                        <p class="text-stone-600 mb-4">${dish.description}</p>
                        <h3 class="text-xl font-bold mb-2 border-b border-amber-200 pb-2 text-amber-800">Main Ingredients</h3>
                        <p class="text-stone-600 mb-4">${dish.ingredients.join(', ')}.</p>
                        <h3 class="text-xl font-bold mb-2 border-b border-amber-200 pb-2 text-amber-800">History & Origin</h3>
                        <p class="text-stone-600 mb-4">${dish.history}</p>
                    </div>
                    <div class="bg-amber-50/50 p-4 rounded-lg">
                        <h3 class="text-2xl font-serif font-bold mb-4 text-center text-amber-900">Sommelier's Suggestions</h3>
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold mb-3 text-stone-800">Recommended Wines</h4>
                            ${generateWinePairingHtml(pairings.wines, dish)}
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-stone-800">Suggested Cocktails</h4>
                            ${generateCocktailPairingHtml(pairings.cocktails, dish)}
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        modalContent.innerHTML = pairingsHtml;
        document.body.style.overflow = 'hidden';
        pairingModal.classList.remove('opacity-0', 'pointer-events-none');
        modalContent.classList.remove('scale-95', 'opacity-0');
    }

    function generateWinePairingHtml(wines, dish) {
        let html = '<ul class="space-y-4">';
        const priceCategories = ['byGlass', 'midRange', 'premium'];
        const categoryLabels = { byGlass: 'Bottle', midRange: 'Bottle', premium: 'Premium Bottle' };

        priceCategories.forEach(category => {
            const wine = wines[category];
            if (wine) {
                const reason = getPairingReason(wine, dish);
                html += `<li><a href="#" onclick="showDrinkDetails(${wine.id}, 'wine')" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-lg hover:border-amber-500 border-2 border-transparent transition-all duration-300">
                    <span class="font-bold text-stone-800">${wine.name}</span><br>
                    <span class="text-sm font-semibold text-amber-700">£${wine.price} - ${categoryLabels[category]}</span><br>
                    <small class="text-stone-500 mt-1 block">${reason}</small>
                </a></li>`;
            } else if (dish.pairingTags.includes('dessert')) {
                // Do not show message for dessert mid/premium
            } else {
                 html += `<li><div class="text-stone-500 p-3 text-sm bg-gray-100 rounded-lg">No specific recommendation in this price range. Please ask your server for guidance.</div></li>`;
            }
        });

        html += '</ul>';
        return html;
    }

    function generateCocktailPairingHtml(cocktails, dish) {
        if (!cocktails || cocktails.length === 0) return '<p class="text-stone-500">No cocktail suggestions for this dish.</p>';
        let html = '<ul class="space-y-4">';
        cocktails.forEach(cocktail => {
            if (cocktail) {
                const reason = getPairingReason(cocktail, dish);
                html += `<li><a href="#" onclick="showDrinkDetails(${cocktail.id}, 'cocktail')" class="block p-4 bg-white rounded-lg shadow-sm hover:shadow-lg hover:border-amber-500 border-2 border-transparent transition-all duration-300">
                    <span class="font-bold text-stone-800">${cocktail.name}</span><br>
                    <span class="text-sm font-semibold text-amber-700">£${cocktail.price}</span><br>
                    <small class="text-stone-500 mt-1 block">${reason}</small>
                </a></li>`;
            }
        });
        html += '</ul>';
        return html;
    }

    // Function to show drink details
    window.showDrinkDetails = function(drinkId, type) {
        const drink = type === 'wine' ? wineMenu.find(w => w.id === drinkId) : cocktailMenu.find(c => c.id === drinkId);
        if (!drink) return;

        let detailsHtml = '';
        if (type === 'wine') {
            const notes = drink.sommelierNotes;
            detailsHtml = `
                <div class="p-6 md:p-8">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 class="text-3xl font-serif font-bold text-stone-900">${drink.name}</h2>
                            <p class="text-stone-500">${drink.type} Wine</p>
                        </div>
                        <button onclick="closeModal()" class="text-3xl text-stone-500 hover:text-stone-800">&times;</button>
                    </div>
                    <div class="space-y-4 text-stone-700">
                        <div><h4 class="font-bold text-lg text-amber-800">Appearance</h4><p>${notes.appearance}</p></div>
                        <div><h4 class="font-bold text-lg text-amber-800">Nose</h4><p>${notes.nose}</p></div>
                        <div><h4 class="font-bold text-lg text-amber-800">Palate</h4><p>${notes.palate}</p></div>
                        <div class="bg-amber-50/50 p-4 rounded-lg mt-6">
                            <h4 class="font-bold text-lg text-amber-900">Sommelier's Summary</h4>
                            <p class="mt-1">${notes.summary}</p>
                        </div>
                    </div>
                    <button onclick="goBackToPairings()" class="mt-8 text-amber-700 font-semibold hover:text-amber-800 transition-colors">← Back to Pairings</button>
                </div>
            `;
        } else { // Cocktail
            detailsHtml = `
                <div class="p-6 md:p-8">
                    <div class="flex justify-between items-start">
                        <h2 class="text-3xl font-serif font-bold text-stone-900">${drink.name} (£${drink.price})</h2>
                        <button onclick="closeModal()" class="text-3xl text-stone-500 hover:text-stone-800">&times;</button>
                    </div>
                    <div class="mt-6 space-y-4 text-stone-700">
                        <div><h4 class="font-bold text-lg text-amber-800">Tasting Notes:</h4><p>${drink.tastingNotes || 'Not available'}</p></div>
                        <div><h4 class="font-bold text-lg text-amber-800">Ingredients:</h4><p>${drink.ingredients.join(', ')}</p></div>
                        <div><h4 class="font-bold text-lg text-amber-800">History:</h4><p>${drink.history || 'Not available'}</p></div>
                    </div>
                    <button onclick="goBackToPairings()" class="mt-8 text-amber-700 font-semibold hover:text-amber-800 transition-colors">← Back to Pairings</button>
                </div>
            `;
        }
        
        window.previousModalState = modalContent.innerHTML;
        modalContent.innerHTML = detailsHtml;
        modalContent.scrollTop = 0;
    }
    
    window.goBackToPairings = function() {
        if (window.previousModalState) {
            modalContent.innerHTML = window.previousModalState;
        }
    }

    window.closeModal = function() {
        document.body.style.overflow = 'auto';
        pairingModal.classList.add('opacity-0', 'pointer-events-none');
        modalContent.classList.add('scale-95', 'opacity-0');
        window.previousModalState = null;
    }

    pairingModal.addEventListener('click', function(event) {
        if (event.target === pairingModal) {
            closeModal();
        }
    });

    document.addEventListener('DOMContentLoaded', renderFoodMenu);

    </script>
</body>
</html>